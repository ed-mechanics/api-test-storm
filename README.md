# API-Test Strom
Этот проект представляет собой систему автоматизации тестирования API, которая использует pytest для выполнения тестов, allure для генерации отчетов и celery для асинхронного запуска задач. Проект построен на основе FastAPI и использует SQLAlchemy для работы с базой данных.

## Описание проекта
Данный проект предназначен для автоматизации тестирования API с использованием динамически генерируемых тестов. Тесты хранятся в базе данных и могут быть запущены через API-запросы. Результаты тестов отображаются в отчетах Allure.

## Технологии
Python 3.11

FastAPI — веб-фреймворк для создания API

Pytest — фреймворк для написания и выполнения тестов

Allure — инструмент для генерации отчетов о тестировании

Celery — система распределенных задач для асинхронного выполнения

Redis — брокер сообщений для Celery

SQLAlchemy — ORM для работы с базой данных

PostgreSQL — база данных для хранения тестов и связанных данных

Docker & Docker Compose — контейнеризация и оркестрация сервисов

## Структура проекта
```bash
├── app
│   ├── __init__.py
│   ├── main.py             # Точка входа FastAPI приложения
│   ├── models.py           # Определения моделей базы данных
│   ├── database.py         # Настройка подключения к базе данных
│   ├── test_runner.py      # Класс для выполнения тестов
│   ├── tasks.py            # Определения задач Celery
│   ├── schemas.py          # Схемы Pydantic для валидации данных
│   └── ...                 # Дополнительные файлы и модули
├── tests
│   ├── __init__.py
│   └── test_generated.py   # Файл для генерации и запуска тестов
├── docker-compose.yml       # Конфигурация Docker Compose
├── Dockerfile               # Dockerfile для приложения
├── requirements.txt         # Зависимости проекта
├── README.md                # Документация проекта
└── ...                      # Другие файлы и директории
```

## Установка и запуск
### Предварительные требования
Docker и Docker Compose должны быть установлены на вашей машине.

Allure Commandline для генерации и просмотра отчетов.

### Настройка переменных окружения
Создайте файл .env в корневой директории проекта и добавьте следующие переменные:
```dotenv
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DB=your_postgres_db
DATABASE_URL=postgresql://your_postgres_user:your_postgres_password@db:5432/your_postgres_db
```

### Запуск с помощью Docker Compose
Запустите приложение и все связанные сервисы:

```bash
docker-compose up --build
```
Это запустит следующие сервисы:

web — FastAPI приложение

worker — Celery worker для выполнения задач

db — PostgreSQL база данных

redis — Redis брокер сообщений

## Использование
### Создание теста
Тесты хранятся в базе данных. Вы можете создавать тесты, добавляя записи в соответствующие таблицы (tests, endpoints, steps). Это можно сделать вручную или воспользовавшись API, описанными в swagger (/docs).

### Запуск теста
Чтобы запустить тест, отправьте POST-запрос на эндпоинт /run_test/{test_id}:

```bash
POST http://localhost:8000/run_test/1
```
Ответ:
```json
{
  "task_id": "your-task-id"
}
```
### Проверка статуса задачи
Отправьте GET-запрос на эндпоинт /task_status/{task_id}:

```bash
GET http://localhost:8000/task_status/your-task-id
```
Возможные статусы:

PENDING — задача ожидает выполнения

STARTED — задача запущена

SUCCESS — задача выполнена успешно

FAILURE — произошла ошибка при выполнении задачи

## Просмотр отчетов Allure
После выполнения тестов отчеты Allure сохраняются в директории ./allure-results.

Сгенерируйте и просмотрите отчет с помощью команды:

```bash
allure serve ./allure-results
```

## Дополнительные сведения
Конфигурация Celery находится в файле app/celery_app.py.

Логирование настроено для отображения информации о выполнении задач и ошибок.
